{% extends "base.html" %}
{% block title %}Маппинг игроков{% endblock %}
{% block content %}
<h1 class="title">Маппинг игроков</h1>
{% if not mapped %}
<div class="notification is-warning">
  <p class="subtitle is-5">⚠️ Маппинг пуст</p>
  <p>Для создания маппинга выполните команду:</p>
  <pre><code>heroku run --app val-draft-app "python3 scripts/map_all_top4_players.py"</code></pre>
  <p>Или локально (если установлен API_FOOTBALL_KEY):</p>
  <pre><code>python3 scripts/map_all_top4_players.py</code></pre>
</div>
{% endif %}
<form method="post" class="mb-4">
  <div class="field">
    <label class="label">Игрок</label>
    <div class="control">
      <div class="select is-fullwidth">
        <select name="fpl_id" required>
          {% for p in players %}
          <option value="{{ p.id }}">{{ p.name }}</option>
          {% endfor %}
        </select>
      </div>
    </div>
  </div>
  <div class="field">
    <label class="label">Mantra Player ID</label>
    <div class="control"><input class="input" type="number" name="mantra_id" required></div>
  </div>
  <div class="field">
    <div class="control"><button class="button is-link" type="submit">Добавить</button></div>
  </div>
</form>
<table class="table is-striped is-compact is-fullwidth">
  <thead>
    <tr>
      <th>API Football ID</th>
      <th>English Name</th>
      <th>Russian Name</th>
      <th>Club Name</th>
      <th>League</th>
      <th>Base ID (Draft)</th>
      <th>Mantra ID</th>
      <th>Third ID</th>
    </tr>
  </thead>
  <tbody>
    {% if mapped %}
      {% for p in mapped %}
      <tr>
        <td>{{ p.api_football_id or "N/A" }}</td>
        <td>{{ p.api_english_name or "N/A" }}</td>
        <td>{{ p.draft_name }}</td>
        <td>{{ p.club_name or "N/A" }}</td>
        <td>{{ p.league or "N/A" }}</td>
        <td>{{ p.base_id }}</td>
        <td>{{ p.mantra_id or "N/A" }}</td>
        <td>{{ p.third_id or "N/A" }}</td>
      </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td colspan="8" class="has-text-centered has-text-grey">
          Нет замаппленных игроков. Запустите скрипт маппинга: <code>python3 scripts/map_all_top4_players.py</code>
        </td>
      </tr>
    {% endif %}
  </tbody>
</table>
{% endblock %}
