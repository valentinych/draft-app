{% extends "base.html" %}
{% block title %}–°–æ—Å—Ç–∞–≤—ã –Ω–∞ Gameweek {{ gw }}{% endblock %}
{% block content %}
<style>
  .live-dot {
    height:6px; width:6px; background-color:red; border-radius:50%;
    display:inline-block; margin-right:2px;
    animation: blink 1s linear infinite;
  }
  @keyframes blink { 50% { opacity:0; } }
</style>
<h1 class="title">–°–æ—Å—Ç–∞–≤—ã –Ω–∞ Gameweek {{ gw }}</h1>
{% if deadline_warsaw %}
<p>–î–µ–¥–ª–∞–π–Ω: {{ deadline_warsaw.strftime("%d.%m %H:%M") }} (–í–∞—Ä—à–∞–≤–∞) / {{ deadline_minsk.strftime("%d.%m %H:%M") }} (–ú–∏–Ω—Å–∫)</p>
{% endif %}
<form method="get" class="mb-4">
  <label class="label">Gameweek</label>
  <div class="field has-addons">
    <div class="control">
      <input class="input" type="number" name="gw" value="{{ gw }}" min="1" style="width:90px"/>
    </div>
    <div class="control">
      <button class="button is-link" type="submit">–ü–æ–∫–∞–∑–∞—Ç—å</button>
    </div>
  </div>
</form>
<table class="table is-striped is-compact">
  <thead>
    <tr>
      {% for m in managers %}
      <th>
        {% if lineups[m].ts %}
        <div class="has-text-grey is-size-7">{{ lineups[m].ts.strftime('%d.%m %H:%M') }}</div>
        {% endif %}
        {{ 'üü¢' if status[m] else 'üî¥' }} {{ m }} <span style="background-color:#006400;color:white;padding:0 4px;border-radius:3px;">{{ lineups[m].total }}</span>
      </th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    <tr>
      {% for m in managers %}
      <td>
        {% set hue = loop.index0 * 60 %}
        {% set c1 = 'hsl(' ~ hue ~ ', 70%, 90%)' %}
        {% set c2 = 'hsl(' ~ hue ~ ', 70%, 80%)' %}
        {% if lineups[m].has_lineup %}
          {% set ns = namespace(last_pos=None) %}
          {% for p in lineups[m].starters %}
            {% if ns.last_pos and p.pos != ns.last_pos %}
              <hr class="my-1"/>
            {% endif %}
            {% set ns.last_pos = p.pos %}
            {% set row_color = c1 if loop.index0 % 2 == 0 else c2 %}
            <div class="is-flex is-justify-content-space-between" style="background-color: {{ row_color }};">
              <span>
                {% if p.status == 'in_progress' %}<span class="live-dot"></span>{% endif %}
                <span class="{{ 'has-text-weight-bold' if p.status == 'finished' and p.minutes > 0 else '' }}">{{ p.name }}</span>
                <img src="https://resources.premierleague.com/premierleague25/badges/{{ p.club }}.svg" alt="{{ p.club }}" style="height:14px; vertical-align:middle"/>
              </span>
              <span class="has-text-right" style="min-width:2em">{{ p.points }}</span>
            </div>
          {% endfor %}
          {% if lineups[m].bench %}
            <div class="mt-2 has-text-weight-semibold">–ó–∞–ø–∞—Å</div>
            {% set ns_bench = namespace(last_pos=None) %}
            {% for p in lineups[m].bench %}
              {% if ns_bench.last_pos and p.pos != ns_bench.last_pos %}
                <hr class="my-1"/>
              {% endif %}
              {% set ns_bench.last_pos = p.pos %}
              {% set row_color = c1 if loop.index0 % 2 == 0 else c2 %}
                <div class="is-flex is-justify-content-space-between has-text-grey" style="background-color: {{ row_color }};">
                  <span>
                    {% if p.status == 'in_progress' %}<span class="live-dot"></span>{% endif %}
                    <span class="{{ 'has-text-weight-bold' if p.status == 'finished' and p.minutes > 0 else '' }}">{{ p.name }} ({{ p.pos }})</span>
                  </span>
                  <span class="has-text-right" style="min-width:2em">{{ p.points }}</span>
                </div>
            {% endfor %}
          {% endif %}
        {% else %}
          {% set ns = namespace(last_pos=None) %}
          {% for p in lineups[m].starters %}
            {% if ns.last_pos and p.pos != ns.last_pos %}
              <hr class="my-1"/>
            {% endif %}
            {% set ns.last_pos = p.pos %}
            {% set row_color = c1 if loop.index0 % 2 == 0 else c2 %}
            <div class="is-flex is-justify-content-space-between" style="background-color: {{ row_color }};">
              <span>
                {% if p.status == 'in_progress' %}<span class="live-dot"></span>{% endif %}
                <span class="{{ 'has-text-weight-bold' if p.status == 'finished' and p.minutes > 0 else '' }}">{{ p.name }}</span>
                <img src="https://resources.premierleague.com/premierleague25/badges/{{ p.club }}.svg" alt="{{ p.club }}" style="height:14px; vertical-align:middle"/>
              </span>
              <span class="has-text-right" style="min-width:2em">{{ p.points }}</span>
            </div>
          {% endfor %}
        {% endif %}
      </td>
      {% endfor %}
    </tr>
  </tbody>
</table>
{% endblock %}
