{# templates/index.html #}
{% extends "base.html" %}

{% block title %}{{ draft_title or 'Fantasy Draft' }}{% endblock %}

{% block content %}
<section class="section">
  <div class="container">

    <div class="level mb-4">
      <div class="level-left">
        <div class="level-item">
          <h2 class="title">{{ draft_title or 'Fantasy Draft' }}</h2>
        </div>
      </div>
      <div class="level-right">
        <div class="level-item">
          <a href="{{ status_url }}" class="button is-info">
            Состояние драфта
          </a>
        </div>
        <div class="level-item">
          <a href="{{ url_for('logout') }}" class="button is-light">
            Выйти
          </a>
        </div>
      </div>
    </div>

    <h3 class="subtitle">
      Ход: <strong>{{ next_user }}</strong>
      {% if next_round %} (Раунд {{ next_round }}){% endif %}
    </h3>

    <form method="get" class="mb-4">
      <div class="field is-grouped">
        <div class="control">
          <div class="select">
            <select name="club">
              <option value="">— Все клубы —</option>
              {% for club in clubs %}
                <option value="{{ club }}" {% if club == club_filter %}selected{% endif %}>
                  {{ club }}
                </option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div class="control">
          <div class="select">
            <select name="position">
              <option value="">— Все позиции —</option>
              {% for pos in positions %}
                <option value="{{ pos }}" {% if pos == pos_filter %}selected{% endif %}>
                  {{ pos }}
                </option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div class="control">
          <button type="submit" class="button">Фильтровать</button>
        </div>
      </div>
    </form>

    <form method="post">
      <table class="table is-striped is-narrow is-hoverable is-fullwidth has-text-centered">
        <thead>
          <tr>
            <th>Имя</th>
            <th>Клуб</th>
            <th>Позиция</th>
            {% if draft_title == 'EPL Fantasy Draft' %}
              <th>Цена</th>
            {% endif %}
            <th>Действия</th>
          </tr>
        </thead>
        <tbody>
          {% for p in players %}
            {% set pickable = (current_user == next_user) or (current_user == 'Руслан') %}
            <tr>
              <td>{{ p.fullName }}</td>
              <td>{{ p.clubName }}</td>
              <td>{{ p.position }}</td>
              {% if draft_title == 'EPL Fantasy Draft' %}
                <td>
                  {% if p.price is defined %}
                    £{{ '%.1f' % p.price }}m
                  {% else %}
                    -
                  {% endif %}
                </td>
              {% endif %}
              <td class="has-text-centered">
                <button
                  class="button is-small is-primary"
                  type="submit"
                  name="player_id"
                  value="{{ p.playerId }}"
                  {% if not pickable %}disabled{% endif %}>
                  Выбрать
                </button>
                {% if draft_title == 'UCL Fantasy Draft' %}
                  <a class="button is-small is-link" href="{{ url_for('stats', pid=p.playerId) }}">
                    Статистика
                  </a>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </form>

  </div>
</section>
{% endblock %}
