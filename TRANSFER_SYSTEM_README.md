# üîÑ Transfer System - –°–∏—Å—Ç–µ–º–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤

–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤ –¥–ª—è –≤—Å–µ—Ö –¥—Ä–∞—Ñ—Ç–æ–≤ (UCL, EPL, TOP4) –≤ Draft App.

## üéØ –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã:
- **–¢—Ä–∞–Ω—Å—Ñ–µ—Ä –∏–≥—Ä–æ–∫–æ–≤** –º–µ–∂–¥—É –∫–æ–º–∞–Ω–¥–∞–º–∏ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- **GW-–±–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ** - –∏–≥—Ä–æ–∫–∏ –∑–∞—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞ —Ç–µ GW –∫–æ–≥–¥–∞ –±—ã–ª–∏ –≤ –∫–æ–º–∞–Ω–¥–µ
- **Transfer Out –ø—É–ª** - –æ—Ç–¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –ø–∏–∫–∞ –¥—Ä—É–≥–∏–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏
- **–ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤** —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤ –ø–æ –ø–æ–∑–∏—Ü–∏—è–º –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **`TransferSystem`** (`transfer_system.py`) - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞–º–∏
2. **Transfer Routes** (`transfer_routes.py`) - Flask –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è API
3. **Scoring Helpers** (`scoring_helpers.py`) - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –ø–æ–¥—Å—á–µ—Ç–∞ –æ—á–∫–æ–≤
4. **UI Components** - –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –∏ JavaScript –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:

```json
{
  "rosters": {
    "manager_name": [
      {
        "playerId": 123,
        "fullName": "Player Name",
        "clubName": "Club",
        "position": "MID",
        "price": 7.5,
        "status": "active|transfer_out|transfer_in",
        "gws_active": [1, 2, 3, 4, 5],
        "transferred_in_gw": 1,
        "transferred_out_gw": null
      }
    ]
  },
  "transfers": {
    "history": [
      {
        "gw": 3,
        "manager": "–†—É—Å–ª–∞–Ω",
        "out_player": {...},
        "in_player": {...},
        "ts": "2025-01-19T12:00:00",
        "draft_type": "UCL"
      }
    ],
    "available_players": [
      {
        "playerId": 456,
        "status": "transfer_out",
        "transferred_out_gw": 3,
        "...": "–ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–æ–∫–µ"
      }
    ]
  }
}
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–∏–µ Transfer System:

```python
from draft_app.transfer_system import create_transfer_system

# –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥—Ä–∞—Ñ—Ç–∞
ucl_transfers = create_transfer_system("UCL")
epl_transfers = create_transfer_system("EPL") 
top4_transfers = create_transfer_system("TOP4")
```

### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞:

```python
state = transfer_system.load_state()

# –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä
updated_state = transfer_system.execute_transfer(
    state=state,
    manager="–†—É—Å–ª–∞–Ω",
    out_player_id=123,
    in_player={
        "playerId": 456,
        "fullName": "New Player",
        "clubName": "New Club",
        "position": "MID",
        "price": 8.0
    },
    current_gw=3
)

transfer_system.save_state(updated_state)
```

### –ü–æ–¥–±–æ—Ä transfer-out –∏–≥—Ä–æ–∫–∞:

```python
# –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
available = transfer_system.get_available_transfer_players(state)

# –ü–æ–¥–æ–±—Ä–∞—Ç—å –∏–≥—Ä–æ–∫–∞
updated_state = transfer_system.pick_transfer_player(
    state=state,
    manager="–ê–Ω–¥—Ä–µ–π", 
    player_id=789,
    current_gw=4
)
```

## üéÆ API Endpoints

### –¢—Ä–∞–Ω—Å—Ñ–µ—Ä—ã:
- `POST /transfers/<draft_type>/execute` - –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä
- `POST /transfers/<draft_type>/pick-transfer-player` - –ü–æ–¥–æ–±—Ä–∞—Ç—å transfer-out –∏–≥—Ä–æ–∫–∞
- `GET /transfers/<draft_type>/available-players` - –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
- `POST /transfers/<draft_type>/validate` - –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
- `GET /transfers/<draft_type>/history` - –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤
- `POST /transfers/<draft_type>/normalize` - –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–≥—Ä–æ–∫–æ–≤ (Admin)

## üñ•Ô∏è –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞:
- **Transfer Modal** - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- **Transfer Players Modal** - –ø—Ä–æ—Å–º–æ—Ç—Ä –∏ –≤—ã–±–æ—Ä –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:

```html
<!-- –ü–æ–¥–∫–ª—é—á–∏—Ç—å –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
{% include 'transfer_modal.html' %}

<!-- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∏–ø –¥—Ä–∞—Ñ—Ç–∞ -->
<script>
window.DRAFT_TYPE = '{{ draft_type|upper }}';
</script>

<!-- –ö–Ω–æ–ø–∫–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ –∏–≥—Ä–æ–∫–∞ -->
<button class="button is-warning" 
        onclick="openTransferModal(this.closest('.player-card'))">
  –¢—Ä–∞–Ω—Å—Ñ–µ—Ä
</button>
```

## üìä –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–æ–¥—Å—á–µ—Ç–æ–º –æ—á–∫–æ–≤

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏–≥—Ä–æ–∫–∞:

```python
from draft_app.scoring_helpers import should_player_score_for_gw

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –¥–æ–ª–∂–µ–Ω –ª–∏ –∏–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞—Ç—å –æ—á–∫–∏ –∑–∞ GW
should_score = should_player_score_for_gw("UCL", player_id=123, gw=5)

# –ü–æ–ª—É—á–∏—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∏–≥—Ä–æ–∫–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ GW  
manager = get_player_manager_for_gw("UCL", player_id=123, gw=5)
```

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–æ—Å—Ç–∞–≤–∞ –ø–æ GW:

```python
from draft_app.scoring_helpers import filter_roster_for_gw

# –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ GW
active_roster = filter_roster_for_gw("EPL", full_roster, gw=3)
```

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### 1. GW-–±–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ:
- –ò–≥—Ä–æ–∫–∏ –∑–∞—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞ GW –∫–æ–≥–¥–∞ –±—ã–ª–∏ –≤ –∫–æ–º–∞–Ω–¥–µ
- –ü–æ–ª–µ `gws_active` —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö GW –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞—Ö

### 2. Transfer Out –ø—É–ª:
- –û—Ç–¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –æ–±—â–∏–π –ø—É–ª
- –î–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –ø–∏–∫–∞ –ª—é–±–æ–π –∫–æ–º–∞–Ω–¥–æ–π
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç –∏—Å—Ç–æ—Ä–∏—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∏–≥—Ä–æ–∫–∞ –≤ —Å–æ—Å—Ç–∞–≤–µ
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ª–∏–º–∏—Ç–∞–º –¥—Ä–∞—Ñ—Ç–∞

### 4. –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è:
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–π

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### 1. –î–æ–±–∞–≤–∏—Ç—å –≤ `__init__.py`:
```python
from .transfer_routes import bp as transfer_bp
app.register_blueprint(transfer_bp)
```

### 2. –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é:
```html
<a href="{{ url_for('transfers.transfer_history', draft_type='ucl') }}">
  –¢—Ä–∞–Ω—Å—Ñ–µ—Ä—ã
</a>
```

### 3. –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–≥—Ä–æ–∫–æ–≤:
```
POST /transfers/<draft_type>/normalize
```

## üìà –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–∞–≤–∏–ª –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
```python
def validate_transfer(self, state, manager, out_player_id, in_player):
    # –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
    is_valid, error_msg = super().validate_transfer(...)
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞
    if custom_rule_check():
        return False, "Custom rule violation"
    
    return is_valid, error_msg
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ API:
```python
def execute_transfer(self, ...):
    # –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä
    updated_state = super().execute_transfer(...)
    
    # –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    notify_external_service(transfer_data)
    
    return updated_state
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö:
- –†–µ–≥—É–ª—è—Ä–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è `gws_active` –º–∞—Å—Å–∏–≤–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è transfer history –∏ current rosters
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö transfer players

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ transfer history
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ available players
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö transfer –∑–∞–ø–∏—Å–µ–π

## üÜò –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **–ò–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–æ—Å—Ç–∞–≤–µ** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö
2. **–ù–µ–≤–µ—Ä–Ω—ã–µ GW –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏** - –ø–µ—Ä–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–≥—Ä–æ–∫–æ–≤
3. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ transfer pool** - –æ—á–∏—Å—Ç–∏—Ç—å available_players

### –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞:
- –í–∫–ª—é—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `transfer_system.py`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ—Ä–µ–∑ `/transfers/<draft_type>/history`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å admin —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
